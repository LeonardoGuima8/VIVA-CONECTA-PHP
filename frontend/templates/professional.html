<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perfil do profissional · VIVA CONECTA</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 font-[Inter]">
  <header class="sticky top-0 z-30 backdrop-blur bg-white/80 border-b border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <a class="flex items-center gap-2 text-primary font-semibold text-lg" href="./index.html">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-primary/10 text-primary">VC</span>
        <span>VIVA CONECTA</span>
      </a>
      <div class="flex items-center gap-3 text-sm">
        <a class="hidden md:inline-flex px-3 py-2 rounded-lg border border-slate-200 hover:border-primary transition" href="./search.html">Voltar à busca</a>
        <a class="inline-flex px-3 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition" href="./dashboard-patient.html">Área do paciente</a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-12 space-y-12">
    <section class="rounded-3xl bg-white border border-slate-100 shadow p-6 md:p-10">
      <div class="flex flex-col md:flex-row gap-8 md:gap-12">
        <div class="flex flex-col items-center text-center space-y-4">
          <div class="h-28 w-28 rounded-3xl bg-primary/10 text-primary text-2xl font-semibold flex items-center justify-center" id="avatar">MD</div>
          <span class="inline-flex items-center gap-2 rounded-full bg-primary/10 px-3 py-1 text-xs font-semibold text-primary">Verificado · CR 123456</span>
          <div class="text-xs text-slate-500 space-y-1">
            <p id="rating">? 4.9 · 132 avaliações</p>
            <p id="experience">12 anos de experiência</p>
          </div>
        </div>
        <div class="flex-1 space-y-6">
          <div>
            <h1 class="text-3xl font-semibold" id="name">Dra. Mariana Duarte</h1>
            <p class="mt-2 text-sm uppercase tracking-widest text-primary font-semibold" id="specialty">Cardiologista · VIVA SAÚDE</p>
          </div>
          <p class="text-sm text-slate-600 leading-relaxed" id="bio">Cardiologista especializada em prevenção e reabilitação cardiovascular, com atuação em hospitais de referência e atendimentos híbridos (presencial + telemedicina). Participa ativamente de programas de educação em saúde e acompanhamento de pacientes complexos.</p>
          <div class="grid sm:grid-cols-3 gap-4 text-sm">
            <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
              <p class="text-slate-400 text-xs uppercase tracking-widest">Atende em</p>
              <p class="mt-2 text-sm font-semibold text-slate-900" id="locations">Asa Sul · Telemedicina</p>
            </div>
            <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
              <p class="text-slate-400 text-xs uppercase tracking-widest">Planos aceitos</p>
              <p class="mt-2 text-sm font-semibold text-slate-900" id="plans">Unimed, SulAmérica, Particular</p>
            </div>
            <div class="rounded-2xl border border-slate-100 bg-slate-50 p-4">
              <p class="text-slate-400 text-xs uppercase tracking-widest">Gamificação</p>
              <p class="mt-2 text-sm font-semibold text-slate-900" id="badges">Nível Ouro · Mentor</p>
            </div>
          </div>
          <div class="flex flex-wrap gap-3 text-xs" id="tags">
            <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">Prevenção cardíaca</span>
            <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">Reabilitação</span>
            <span class="inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1">Teleconsulta</span>
          </div>
          <div class="flex flex-wrap gap-3 text-sm">
            <button class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-primary/90 transition" data-action="schedule">Agendar consulta</button>
            <button class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 font-semibold hover:border-primary transition" data-action="chat">Abrir chat interno</button>
            <button class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-slate-200 font-semibold hover:border-primary transition" data-action="whatsapp">Enviar WhatsApp</button>
          </div>
        </div>
      </div>
    </section>

    <section class="grid lg:grid-cols-[2fr_1fr] gap-8">
      <div class="space-y-6">
        <div class="rounded-3xl bg-white border border-slate-100 p-6">
          <header class="flex items-center justify-between">
            <h2 class="text-lg font-semibold">Agenda disponível</h2>
            <a href="#" class="text-sm text-primary hover:underline">Sincronizar agenda</a>
          </header>
          <div id="availability" class="mt-4 grid sm:grid-cols-3 gap-3 text-sm"></div>
        </div>
        <div class="rounded-3xl bg-white border border-slate-100 p-6 space-y-4">
          <h2 class="text-lg font-semibold">Experiência do paciente</h2>
          <div id="reviews" class="space-y-4 text-sm text-slate-600"></div>
          <a href="#" class="inline-flex items-center gap-2 text-sm font-semibold text-primary hover:underline">Ver todas avaliações</a>
        </div>
      </div>
      <aside class="space-y-6">
        <div class="rounded-3xl bg-white border border-slate-100 p-6">
          <h3 class="text-sm font-semibold text-slate-700 uppercase tracking-widest">Checklist LGPD</h3>
          <ul class="mt-3 space-y-2 text-sm text-slate-600">
            <li class="flex items-start gap-2"><span class="text-secondary">•</span> Termo de consentimento digital armazenado no Supabase Storage.</li>
            <li class="flex items-start gap-2"><span class="text-secondary">•</span> Chat interno com retenção de 90 dias.</li>
            <li class="flex items-start gap-2"><span class="text-secondary">•</span> Dados sensíveis criptografados em repouso.</li>
          </ul>
        </div>
        <div class="rounded-3xl bg-white border border-slate-100 p-6">
          <h3 class="text-sm font-semibold text-slate-700 uppercase tracking-widest">Cupons ativos</h3>
          <div id="coupons" class="mt-3 space-y-3 text-sm text-slate-600">
            <p>Nenhum cupom disponível no momento.</p>
          </div>
          <a class="mt-4 inline-flex items-center gap-2 text-sm font-semibold text-primary hover:underline" href="./coupons.html">Explorar VIVA BELEZA</a>
        </div>
      </aside>
    </section>
  </main>

  <footer class="bg-white border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 py-8 text-sm text-slate-500 flex flex-col sm:flex-row sm:justify-between gap-3">
      <p>© 2025 VIVA CONECTA</p>
      <p><a class="text-primary hover:underline" href="mailto:contato@vivaconecta.com">contato@vivaconecta.com</a></p>
    </div>
  </footer>

  <script>
    async function loadProfile() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id') || 'demo-id';
      try {
        const response = await fetch(`/api/v1/professionals/${id}`);
        const payload = await response.json();
        const data = payload.data || payload.profile || {};
        document.getElementById('name').textContent = data.name || 'Profissional VIVA';
        document.getElementById('specialty').textContent = (data.specialties?.[0]?.specialty_name || 'Especialidade') + ' · ' + (data.vertical_segments?.[0] || 'VIVA');
        document.getElementById('bio').textContent = data.bio || 'Profissional cadastrado na plataforma.';
        document.getElementById('plans').textContent = (data.plans || ['Particular']).join(', ');
        document.getElementById('locations').textContent = data.city ? `${data.city} · ${data.state}` : 'Atendimento híbrido';
        document.getElementById('rating').textContent = `? ${(data.rating_average || 4.8).toFixed(1)} · ${data.reviews_count || 0} avaliações`;
        document.getElementById('experience').textContent = `${data.years_experience || 0} anos de experiência`;
        const tags = document.getElementById('tags');
        tags.innerHTML = '';
        (data.specialties || []).forEach((spec) => {
          const badge = document.createElement('span');
          badge.className = 'inline-flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1';
          badge.textContent = spec.subspecialty_name || spec.specialty_name;
          tags.appendChild(badge);
        });
      } catch (error) {
        console.error(error);
      }
    }

    async function loadAvailability() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id') || 'demo-id';
      try {
        const response = await fetch(`/api/v1/professionals/${id}/availability`);
        const payload = await response.json();
        const container = document.getElementById('availability');
        container.innerHTML = '';
        (payload.data || []).slice(0, 6).forEach((slot) => {
          const card = document.createElement('div');
          card.className = 'rounded-2xl border border-slate-100 bg-slate-50 p-4';
          card.innerHTML = `<p class="text-xs text-slate-400 uppercase">${slot.channel}</p><p class="text-sm font-semibold text-slate-900">${slot.date}</p><p class="text-sm text-slate-600">${slot.start_time} - ${slot.end_time}</p>`;
          container.appendChild(card);
        });
      } catch (error) {
        console.error(error);
      }
    }

    async function loadReviews() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id') || 'demo-id';
      try {
        const response = await fetch(`/api/v1/professionals/${id}/reviews`);
        const payload = await response.json();
        const container = document.getElementById('reviews');
        container.innerHTML = '';
        (payload.data || []).slice(0, 3).forEach((review) => {
          const card = document.createElement('div');
          card.className = 'rounded-2xl border border-slate-100 bg-slate-50 p-4';
          card.innerHTML = `<p class="text-sm font-semibold text-slate-900">${review.rater_name || 'Paciente VIVA'}</p><p class="text-xs text-slate-500">${(review.rating || 5).toFixed(1)} · ${review.published_at?.slice(0, 10) || ''}</p><p class="mt-2 text-sm text-slate-600">${review.comment || 'Experiência positiva.'}</p>`;
          container.appendChild(card);
        });
      } catch (error) {
        console.error(error);
      }
    }

    loadProfile();
    loadAvailability();
    loadReviews();
  </script>
</body>
</html>
