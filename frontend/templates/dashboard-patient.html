<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard Paciente · VIVA CONECTA</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-slate-900 text-slate-100 font-[Inter]">
  <header class="sticky top-0 z-20 bg-slate-900/80 backdrop-blur border-b border-slate-800">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <a class="flex items-center gap-2 text-white font-semibold text-lg" href="./index.html">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-lg bg-primary/20 text-primary">VC</span>
        <span>Área do Paciente</span>
      </a>
      <nav class="flex items-center gap-5 text-sm text-slate-400">
        <a class="hover:text-white transition" href="./dashboard-patient.html">Resumo</a>
        <a class="hover:text-white transition" href="./coupons.html">Cupons</a>
        <a class="hover:text-white transition" href="./chat.html">Chat</a>
      </nav>
      <div class="flex items-center gap-3 text-sm">
        <span class="hidden sm:flex items-center gap-2 px-3 py-2 rounded-lg bg-slate-800 text-slate-200">Olá, Ana</span>
        <a class="inline-flex px-3 py-2 rounded-lg bg-primary text-white hover:bg-primary/90 transition" href="./logout.html">Sair</a>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-12 space-y-10">
    <section class="grid md:grid-cols-3 gap-6">
      <article class="rounded-3xl bg-gradient-to-br from-primary/40 to-primary/10 border border-primary/30 p-6">
        <p class="text-xs uppercase tracking-widest text-slate-200">Próxima consulta</p>
        <p class="mt-3 text-2xl font-semibold text-white" id="next-appointment">15 Fev · 15h30 · Telemedicina</p>
        <p class="mt-2 text-sm text-slate-200">Confirme presença com antecedência mínima de 2h.</p>
      </article>
      <article class="rounded-3xl bg-slate-800 border border-slate-700 p-6">
        <p class="text-xs uppercase tracking-widest text-slate-400">Histórico completo</p>
        <p class="mt-3 text-2xl font-semibold text-white" id="history-count">22 consultas concluídas</p>
        <p class="mt-2 text-sm text-slate-400">Acesso ao prontuário e laudos dentro da LGPD.</p>
      </article>
      <article class="rounded-3xl bg-slate-800 border border-slate-700 p-6">
        <p class="text-xs uppercase tracking-widest text-slate-400">Pontos de fidelidade</p>
        <p class="mt-3 text-2xl font-semibold text-white" id="gamification-points">740 pontos · Nível 4</p>
        <p class="mt-2 text-sm text-slate-400">Troque por descontos em procedimentos de bem-estar.</p>
      </article>
    </section>

    <section class="rounded-3xl bg-slate-800/80 border border-slate-700 p-6">
      <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h2 class="text-lg font-semibold text-white">Últimas interações</h2>
          <p class="text-sm text-slate-400">Eventos capturados da API `/api/v1/appointments/:id/timeline`.</p>
        </div>
        <a class="inline-flex items-center gap-2 text-sm text-primary hover:underline" href="./appointments.html">Ver todas</a>
      </header>
      <ul class="mt-6 space-y-4" id="timeline"></ul>
    </section>

    <section class="grid lg:grid-cols-2 gap-6">
      <div class="rounded-3xl bg-slate-800/80 border border-slate-700 p-6">
        <h2 class="text-lg font-semibold text-white">Cupons disponíveis</h2>
        <p class="text-sm text-slate-400">Cupons da vertical VIVA BELEZA sincronizados via `/api/v1/coupons`.</p>
        <div class="mt-5 space-y-4 text-sm" id="coupon-list"></div>
        <a class="mt-4 inline-flex items-center gap-2 text-sm text-primary hover:underline" href="./coupons.html">Ver catálogo</a>
      </div>
      <div class="rounded-3xl bg-slate-800/80 border border-slate-700 p-6">
        <h2 class="text-lg font-semibold text-white">Chat & notificações</h2>
        <p class="text-sm text-slate-400">Acompanhe mensagens e alertas prioritários.</p>
        <div class="mt-5 space-y-3 text-sm" id="notifications"></div>
      </div>
    </section>
  </main>

  <script>
    async function loadDashboard() {
      try {
        const response = await fetch('/api/v1/dashboard/patient?user_id=current-user');
        const payload = await response.json();
        const data = payload.data || {};
        document.getElementById('next-appointment').textContent = data.upcoming?.[0]?.scheduled_at || 'Sem consultas agendadas';
        document.getElementById('history-count').textContent = `${data.history || 0} consultas concluídas`;
      } catch (error) {
        console.error(error);
      }
    }

    async function loadTimeline() {
      const container = document.getElementById('timeline');
      container.innerHTML = '';
      const events = [
        { type: 'confirmação', detail: 'Consulta com Dra. Mariana confirmada', at: 'Hoje · 09h12' },
        { type: 'mensagem', detail: 'Novo recado no chat pré-consulta', at: 'Ontem · 18h44' },
        { type: 'check-in', detail: 'Check-in QR Code validado pela recepção', at: '10 Jan · 14h15' },
      ];
      events.forEach((event) => {
        const item = document.createElement('li');
        item.className = 'rounded-2xl border border-slate-700 bg-slate-900/50 p-4';
        item.innerHTML = `<p class="text-sm font-semibold text-white">${event.type}</p><p class="text-sm text-slate-300 mt-1">${event.detail}</p><p class="text-xs text-slate-500 mt-2">${event.at}</p>`;
        container.appendChild(item);
      });
    }

    async function loadCoupons() {
      try {
        const response = await fetch('/api/v1/coupons');
        const payload = await response.json();
        const list = document.getElementById('coupon-list');
        list.innerHTML = '';
        (payload.data || []).slice(0, 3).forEach((coupon) => {
          const card = document.createElement('div');
          card.className = 'rounded-2xl border border-slate-700 bg-slate-900/50 p-4 flex flex-col gap-2';
          card.innerHTML = `<p class="text-sm font-semibold text-white">${coupon.title || 'Cupom VIVA'}</p><p class="text-xs text-slate-400">Código: ${coupon.code}</p><p class="text-sm text-slate-300">${coupon.description || ''}</p>`;
          list.appendChild(card);
        });
      } catch (error) {
        console.error(error);
      }
    }

    async function loadNotifications() {
      try {
        const response = await fetch('/api/v1/notifications?user_id=current-user');
        const payload = await response.json();
        const list = document.getElementById('notifications');
        list.innerHTML = '';
        (payload.data || []).slice(0, 4).forEach((notification) => {
          const card = document.createElement('div');
          card.className = 'rounded-2xl border border-slate-700 bg-slate-900/50 p-4';
          card.innerHTML = `<p class="text-sm font-semibold text-white">${notification.title || 'Notificação'}</p><p class="text-xs text-slate-400 mt-1">${notification.created_at || ''}</p><p class="text-sm text-slate-300 mt-2">${notification.body || ''}</p>`;
          list.appendChild(card);
        });
      } catch (error) {
        console.error(error);
      }
    }

    loadDashboard();
    loadTimeline();
    loadCoupons();
    loadNotifications();
  </script>
</body>
</html>
